<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Trading Pro</title>
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* --- PROFESSIONAL DARK THEME --- */
        :root { --bg: #000000; --card: #121212; --green: #00C853; --red: #D50000; --text: #E0E0E0; --accent: #2962FF; }
        body { margin: 0; font-family: 'Roboto', sans-serif; background: var(--bg); color: var(--text); padding-bottom: 70px; user-select: none; }
        
        /* HEADER & TICKER */
        header { background: #1a1a1a; padding: 15px; text-align: center; border-bottom: 1px solid #333; position: sticky; top: 0; z-index: 100; }
        header h2 { margin: 0; color: var(--green); font-size: 18px; letter-spacing: 1px; text-transform: uppercase; }
        
        .ticker-wrap { background: #0f0f0f; overflow: hidden; height: 30px; border-bottom: 1px solid #222; display: flex; align-items: center; }
        .ticker { display: flex; animation: ticker 20s infinite linear; white-space: nowrap; }
        .ticker-item { padding: 0 20px; font-size: 12px; font-weight: bold; }
        .up { color: var(--green); } .down { color: var(--red); }
        @keyframes ticker { 0% { transform: translateX(100%); } 100% { transform: translateX(-100%); } }

        /* NAVIGATION TABS */
        .nav-bar { position: fixed; bottom: 0; width: 100%; background: #111; display: flex; justify-content: space-around; padding: 10px 0; border-top: 1px solid #333; z-index: 999; }
        .nav-item { color: gray; text-align: center; font-size: 10px; cursor: pointer; flex: 1; }
        .nav-item i { font-size: 20px; margin-bottom: 5px; display: block; }
        .nav-item.active { color: var(--green); }

        /* SECTIONS */
        .section { display: none; padding: 15px; }
        .section.active { display: block; }

        /* ADS & DISCLAIMER */
        .ad-banner { height: 50px; background: #1e1e1e; margin: 10px 0; border: 1px dashed #444; display: flex; align-items: center; justify-content: center; font-size: 10px; color: #555; border-radius: 5px; }
        .disclaimer { background: rgba(255, 152, 0, 0.15); color: #FF9800; padding: 10px; font-size: 11px; border-radius: 5px; margin-bottom: 15px; border-left: 3px solid #FF9800; }

        /* CARDS (News & Video) */
        .card { background: var(--card); padding: 15px; border-radius: 8px; margin-bottom: 15px; border: 1px solid #222; }
        .card h3 { margin: 0 0 5px 0; font-size: 16px; color: #fff; }
        .card p { font-size: 13px; color: #aaa; line-height: 1.4; margin: 0; }
        .video-container { position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; border-radius: 8px; margin-top: 10px; }
        .video-container iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }

        /* CALCULATOR GRID */
        .tools-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .tool-card { background: var(--card); padding: 15px; border-radius: 8px; text-align: center; cursor: pointer; border: 1px solid #333; }
        .tool-card:active { background: #222; }
        .tool-card i { font-size: 24px; color: var(--green); margin-bottom: 8px; }
        
        /* CALCULATOR INPUTS */
        .calc-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: black; z-index: 2000; padding: 20px; box-sizing: border-box; }
        .calc-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 1px solid #333; padding-bottom: 10px; }
        input { width: 100%; background: #222; border: 1px solid #444; color: white; padding: 12px; margin-bottom: 10px; border-radius: 5px; box-sizing: border-box; font-size: 16px; }
        .btn-action { width: 100%; background: var(--green); color: black; padding: 12px; border: none; font-weight: bold; border-radius: 5px; font-size: 16px; }
        .result-box { margin-top: 20px; padding: 15px; background: #1a1a1a; border-radius: 5px; text-align: center; font-size: 20px; font-weight: bold; }
    </style>
</head>
<body>

    <header>
        <h2>Smart Trader</h2>
    </header>

    <!-- MARKET TICKER -->
    <div class="ticker-wrap">
        <div class="ticker">
            <span class="ticker-item">NIFTY 50: <span class="up">22,510 (+0.4%)</span></span>
            <span class="ticker-item">BANK NIFTY: <span class="down">47,100 (-0.1%)</span></span>
            <span class="ticker-item">SENSEX: <span class="up">73,200 (+0.3%)</span></span>
            <span class="ticker-item">FINNIFTY: <span class="up">20,900 (+0.2%)</span></span>
            <span class="ticker-item">GOLD: <span class="down">62,500 (-0.5%)</span></span>
        </div>
    </div>

    <!-- 1. HOME (NEWS) -->
    <div id="home" class="section active">
        <div class="disclaimer"><i class="fas fa-exclamation-triangle"></i> Disclaimer: Investments are subject to market risks. Read all documents carefully.</div>
        <div class="ad-banner">AdMob Banner Space</div>
        
        <h3 style="color:var(--green); margin-bottom:10px;">Market Updates</h3>
        <div id="news-list">
            <div style="text-align:center; color:gray; padding:20px;">Loading News...</div>
        </div>
    </div>

    <!-- 2. VIDEO COURSE -->
    <div id="video" class="section">
        <h3 style="color:var(--green); margin-bottom:10px;">Premium Video Course</h3>
        <div class="ad-banner">AdMob Banner Space</div>
        <div id="video-list">
            <div style="text-align:center; color:gray; padding:20px;">Loading Videos...</div>
        </div>
    </div>

    <!-- 3. TOOLS (4 CALCULATORS) -->
    <div id="tools" class="section">
        <h3 style="color:var(--green); margin-bottom:10px;">Trading Tools</h3>
        <div class="tools-grid">
            <div class="tool-card" onclick="openCalc('pnl')"><i class="fas fa-calculator"></i><br>Profit/Loss</div>
            <div class="tool-card" onclick="openCalc('position')"><i class="fas fa-chart-pie"></i><br>Position Size</div>
            <div class="tool-card" onclick="openCalc('sip')"><i class="fas fa-piggy-bank"></i><br>SIP Calc</div>
            <div class="tool-card" onclick="openCalc('avg')"><i class="fas fa-balance-scale"></i><br>Stock Avg</div>
        </div>
        <div class="ad-banner" style="margin-top:20px;">AdMob Banner Space</div>
    </div>

    <!-- CALCULATOR MODALS -->
    <!-- 1. P&L -->
    <div id="pnl" class="calc-modal">
        <div class="calc-header"><h3>P&L Calculator</h3> <i class="fas fa-times" onclick="closeCalc('pnl')" style="font-size:24px;"></i></div>
        <input type="number" id="pnl-buy" placeholder="Buy Price">
        <input type="number" id="pnl-sell" placeholder="Sell Price">
        <input type="number" id="pnl-qty" placeholder="Quantity">
        <button class="btn-action" onclick="calcPnL()">Calculate</button>
        <div id="pnl-res" class="result-box">Result: â‚¹0</div>
    </div>

    <!-- 2. Position Size -->
    <div id="position" class="calc-modal">
        <div class="calc-header"><h3>Position Size</h3> <i class="fas fa-times" onclick="closeCalc('position')" style="font-size:24px;"></i></div>
        <input type="number" id="pos-cap" placeholder="Total Capital (â‚¹)">
        <input type="number" id="pos-risk" placeholder="Risk Per Trade (%)">
        <input type="number" id="pos-sl" placeholder="Stop Loss (Points)">
        <button class="btn-action" onclick="calcPos()">Get Quantity</button>
        <div id="pos-res" class="result-box">Qty: 0</div>
    </div>

    <!-- 3. SIP -->
    <div id="sip" class="calc-modal">
        <div class="calc-header"><h3>SIP Calculator</h3> <i class="fas fa-times" onclick="closeCalc('sip')" style="font-size:24px;"></i></div>
        <input type="number" id="sip-amt" placeholder="Monthly Investment">
        <input type="number" id="sip-rate" placeholder="Expected Return (%)">
        <input type="number" id="sip-year" placeholder="Time Period (Years)">
        <button class="btn-action" onclick="calcSIP()">Calculate</button>
        <div id="sip-res" class="result-box">Value: â‚¹0</div>
    </div>

    <!-- 4. Average -->
    <div id="avg" class="calc-modal">
        <div class="calc-header"><h3>Stock Average</h3> <i class="fas fa-times" onclick="closeCalc('avg')" style="font-size:24px;"></i></div>
        <input type="number" id="avg-p1" placeholder="First Buy Price">
        <input type="number" id="avg-q1" placeholder="First Quantity">
        <input type="number" id="avg-p2" placeholder="New Buy Price">
        <input type="number" id="avg-q2" placeholder="New Quantity">
        <button class="btn-action" onclick="calcAvg()">Get Average</button>
        <div id="avg-res" class="result-box">Avg Price: â‚¹0</div>
    </div>

    <!-- NAV BAR -->
    <div class="nav-bar">
        <div class="nav-item active" onclick="switchTab('home', this)"><i class="fas fa-newspaper"></i>Market</div>
        <div class="nav-item" onclick="switchTab('video', this)"><i class="fas fa-play-circle"></i>Course</div>
        <div class="nav-item" onclick="switchTab('tools', this)"><i class="fas fa-tools"></i>Tools</div>
    </div>

    <!-- LOGIC -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
        import { getFirestore, collection, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

        // ðŸ”´ðŸ”´ APNA FIREBASE CONFIG YAHAN PASTE KAREIN ðŸ”´ðŸ”´
        const firebaseConfig = {
  apiKey: "AIzaSyDid938gjPC-gbDLBQQk1T0jBwYyRJ8nY8",
  authDomain: "guru-trading.firebaseapp.com",
  databaseURL: "https://guru-trading-default-rtdb.firebaseio.com",
  projectId: "guru-trading",
  storageBucket: "guru-trading.firebasestorage.app",
  messagingSenderId: "329577116789",
  appId: "1:329577116789:web:a7ed8bc0c82413053bb43c"
};

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // --- FETCH DATA ---
        const q = query(collection(db, "content"), orderBy("timestamp", "desc"));
        
        onSnapshot(q, (snapshot) => {
            const newsDiv = document.getElementById('news-list');
            const videoDiv = document.getElementById('video-list');
            newsDiv.innerHTML = "";
            videoDiv.innerHTML = "";

            if(snapshot.empty) {
                newsDiv.innerHTML = "<p style='text-align:center'>No Data</p>";
                videoDiv.innerHTML = "<p style='text-align:center'>No Videos</p>";
                return;
            }

            snapshot.forEach(doc => {
                const data = doc.data();
                
                if(data.type === 'news') {
                    newsDiv.innerHTML += `
                        <div class="card">
                            <h3><i class="fas fa-bolt" style="color:#FFC107"></i> ${data.title}</h3>
                            <p>${data.body}</p>
                            <div style="font-size:10px; color:#555; margin-top:5px; text-align:right;">${new Date(data.timestamp?.toDate()).toLocaleDateString()}</div>
                        </div>`;
                } else if(data.type === 'video') {
                    // Extract Video ID from URL
                    let vidId = data.body.split('v=')[1];
                    if(!vidId) vidId = data.body.split('/').pop(); // Handle short links
                    const embedUrl = `https://www.youtube.com/embed/${vidId}`;
                    
                    videoDiv.innerHTML += `
                        <div class="card">
                            <h3>${data.title}</h3>
                            <div class="video-container">
                                <iframe src="${embedUrl}" frameborder="0" allowfullscreen></iframe>
                            </div>
                        </div>`;
                }
            });
        });
    </script>

    <script>
        // --- UI LOGIC ---
        function switchTab(id, btn) {
            document.querySelectorAll('.section').forEach(d => d.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        }

        function openCalc(id) { document.getElementById(id).style.display = 'block'; }
        function closeCalc(id) { document.getElementById(id).style.display = 'none'; }

        // --- CALCULATORS LOGIC (Global) ---
        function calcPnL() {
            let b = Number(document.getElementById('pnl-buy').value);
            let s = Number(document.getElementById('pnl-sell').value);
            let q = Number(document.getElementById('pnl-qty').value);
            let r = (s-b)*q;
            let el = document.getElementById('pnl-res');
            el.innerHTML = r >= 0 ? `Profit: â‚¹${r.toFixed(2)}` : `Loss: â‚¹${r.toFixed(2)}`;
            el.style.color = r >= 0 ? '#00C853' : '#D50000';
        }

        function calcPos() {
            let cap = Number(document.getElementById('pos-cap').value);
            let risk = Number(document.getElementById('pos-risk').value);
            let sl = Number(document.getElementById('pos-sl').value);
            let qty = Math.floor(((cap * risk)/100) / sl);
            document.getElementById('pos-res').innerHTML = `Buy Qty: ${qty}`;
        }

        function calcSIP() {
            let p = Number(document.getElementById('sip-amt').value);
            let r = Number(document.getElementById('sip-rate').value) / 1200;
            let n = Number(document.getElementById('sip-year').value) * 12;
            let val = p * ( (Math.pow(1+r, n) - 1) / r ) * (1+r);
            document.getElementById('sip-res').innerHTML = `Total: â‚¹${val.toFixed(0)}`;
        }

        function calcAvg() {
            let p1 = Number(document.getElementById('avg-p1').value);
            let q1 = Number(document.getElementById('avg-q1').value);
            let p2 = Number(document.getElementById('avg-p2').value);
            let q2 = Number(document.getElementById('avg-q2').value);
            let avg = ((p1*q1) + (p2*q2)) / (q1+q2);
            document.getElementById('avg-res').innerHTML = `Avg Price: â‚¹${avg.toFixed(2)}`;
        }
    </script>
</body>
</html>